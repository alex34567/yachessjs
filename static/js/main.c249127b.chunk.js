(this.webpackJsonpyachessjs=this.webpackJsonpyachessjs||[]).push([[0],{27:function(e){e.exports=JSON.parse('[{"name":"Black & White","id":"monochrome","blackColor":"#212121","whiteColor":"white"},{"name":"Gray","id":"gray","blackColor":"darkGray","whiteColor":"lightGray"},{"name":"Green","id":"green","blackColor":"green","whiteColor":"#F0F0F0"},{"name":"Wood","id":"wood","blackColor":"#794932","whiteColor":"#d19c70"}]')},28:function(e){e.exports=JSON.parse('[{"name":"Cburnett","prefix":"cburnett"},{"name":"Merida","prefix":"merida"}]')},32:function(e){e.exports=JSON.parse('{"piece":{"name":"Cburnett","prefix":"cburnett"},"boardSquare":{"name":"Wood","id":"wood","blackColor":"#794932","whiteColor":"#d19c70"}}')},37:function(e,t,n){},38:function(e,t,n){},51:function(e,t,n){"use strict";n.r(t);var r=n(1),i=n.n(r),a=n(30),o=n.n(a),s=(n(37),n(6)),c=(n(38),n(2)),u=n(3);function h(e){return e.toLowerCase().charCodeAt(0)-"a".charCodeAt(0)}function l(e){return Number(e)-1}var d=function(){function e(t,n){if(Object(c.a)(this,e),this.file=void 0,this.rank=void 0,this.file=t,this.rank=n,!Number.isInteger(n)||!Number.isInteger(t)||n<0||n>7||t<0||t>7)throw new Error("Invalid board pos")}return Object(u.a)(e,[{key:"add",value:function(t,n){var r=this.file+t,i=this.rank+n;return r<0||r>7||i<0||i>7?null:new e(r,i)}},{key:"addFile",value:function(e){return this.add(e,0)}},{key:"addRank",value:function(e){return this.add(0,e)}},{key:"toRaw",value:function(){return 8*this.rank+this.file}},{key:"toString",value:function(){return String.fromCharCode(this.file+"a".charCodeAt(0))+String(this.rank+1)}},{key:"compare",value:function(e){var t=this.file-e.file;return 0!==t?t:this.rank-e.rank}}],[{key:"fromRaw",value:function(t){return new e(t%8,Math.floor(t/8))}}]),e}(),f=function(){function e(){Object(c.a)(this,e),this.currMoveStr=void 0,this.totalMoveStr=void 0,this.currMoveStr="",this.totalMoveStr=""}return Object(u.a)(e,[{key:"addToken",value:function(e){if(""===this.currMoveStr)this.currMoveStr=e;else{var t=this.currMoveStr+" "+e;t.length>80?(this.totalMoveStr+="\n"+this.currMoveStr,this.currMoveStr=e):this.currMoveStr=t}}},{key:"done",value:function(){return this.totalMoveStr+"\n"+this.currMoveStr}}]),e}(),v=n(9),b=n(5),O=n(4),j=n(18),m=n(14),k=/^([KQRBN]?)([a-h]?)([1-8]?)(x?)([a-h])([1-8])(?:=?([QRBN]))?(?:\+|#|)(?:\?\??|!!?|\?!|!\?|)$/,p=function(){function e(){if(Object(c.a)(this,e),"function"!==typeof this.matches)throw new Error("Matches function not defined")}return Object(u.a)(e,null,[{key:"parseMove",value:function(e,t){if("O-O"===(t=t.trim())||"0-0"===t)return new y(!0);if("O-O-O"===t||"0-0-0"===t)return new y(!1);var n=k.exec(t);if(!n)return null;var r=n[1],i=e.FROM_LETTER.get(r),a=n[2],o=a?h(a):null,s=n[3],c=s?l(s):null,u="x"===n[4],f=h(n[5]),v=l(n[6]),b=new d(f,v),O=n[7],j=null;return O&&(j=e.FROM_LETTER.get(O)),new g(i,u,o,c,b,j)}}]),e}(),y=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this)).isKingSide=void 0,r.isKingSide=e,r}return Object(u.a)(n,[{key:"toString",value:function(){return this.isKingSide?"O-O":"O-O-O"}},{key:"matches",value:function(e){return e.isCastle()&&this.isKingSide===e.isKingSide}}]),n}(p),g=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e,r,i,a,o,s){var u;return Object(c.a)(this,n),(u=t.call(this)).piece=void 0,u.captures=void 0,u.fromFile=void 0,u.fromRank=void 0,u.toPos=void 0,u.promoteChoice=void 0,u.checkSymbol=void 0,u.piece=e,u.captures=r,u.fromFile=i,u.fromRank=a,u.toPos=o,u.promoteChoice=s,u.checkSymbol="",u}return Object(u.a)(n,[{key:"toString",value:function(){var e="";this.captures&&(e="x");var t="";null!==this.fromFile&&(t=String.fromCharCode(this.fromFile+"a".charCodeAt(0)));var n="";null!==this.fromRank&&(n=String(this.fromRank+1));var r="";return this.promoteChoice&&(r+="="+this.promoteChoice.getPGNLetter()),this.piece.getPGNLetter()+t+n+e+this.toPos.toString()+r+this.checkSymbol}},{key:"matches",value:function(e){return(this.piece===e.state.currTurn.PAWN||!this.promoteChoice)&&(!!e.isNormal()&&(!(this.captures&&!e.state.board.get(this.toPos).canBeCaptured(e.piece)&&!e.isEnPassant())&&((!e.isPromote()||this.promoteChoice===e.promoteChoice)&&(!(!e.isPromote()&&this.promoteChoice)&&(e.piece===this.piece&&(null===this.fromFile||this.fromFile===e.fromPos.file)&&(null===this.fromRank||this.fromRank===e.fromPos.rank)&&0===e.toPos.compare(this.toPos))))))}}]),n}(p),w=n(15),P=n(16),C=n.n(P),N=function(){function e(t){if(Object(c.a)(this,e),this.state=void 0,this.state=t,"function"!==typeof this.toNotation)throw new Error("To notation function not defined")}return Object(u.a)(e,[{key:"isNormal",value:function(){return!1}},{key:"isCastle",value:function(){return!1}},{key:"isEnPassant",value:function(){return!1}},{key:"do",value:function(){var e=this;return this.state.flipTurn().modify((function(t){return e.doChain(t)}))}},{key:"doChain",value:function(e){e.isHistory()&&(e.moveHistory=e.moveHistory.setSize(e.moveIndex),e.moveIndex++),e.halfMove++,e.moveHistory=e.moveHistory.push(this);var t=this.state.toAbvFen(),n=e.threeFoldDetect.get(t);n||(n=0),n++,e.threeFoldDetect=e.threeFoldDetect.set(t,n)}}]),e}(),S=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e,r,i,a){var o;return Object(c.a)(this,n),(o=t.call(this,e)).piece=void 0,o.fromPos=void 0,o.toPos=void 0,o.piece=r,o.fromPos=i,o.toPos=a,o}return Object(u.a)(n,[{key:"isNormal",value:function(){return!0}},{key:"isPromote",value:function(){return!1}},{key:"isCapture",value:function(){return this.state.board.get(this.toPos).isOccupied()}},{key:"toNotation",value:function(){var e=null;this.isPromote()&&(e=this.promoteChoice);var t=new g(this.piece,this.isCapture(),null,null,this.toPos,e),n=this.state.moves().filter((function(e){return t.matches(e)&&!e.invalid()}));(n.length>1||this.isCapture()&&this.piece===this.piece.color.PAWN)&&(t.fromFile=this.fromPos.file,(n=this.state.moves().filter((function(e){return t.matches(e)&&!e.invalid()}))).length>1&&(t.fromFile=null,t.fromRank=this.fromPos.rank,(n=this.state.moves().filter((function(e){return t.matches(e)&&!e.invalid()}))).length>1&&(t.fromFile=this.fromPos.file,t.fromRank=this.fromPos.rank)));var r=this.do();return r.isCheckmate()?t.checkSymbol="#":r.isCheck()&&(t.checkSymbol="+"),t}},{key:"invalid",value:function(){if(this.piece===this.state.currTurn.KING)return!!this.state.board.isProtected(this.toPos)&&"Check";if(this.state.checks>1)return"Check";if(this.state.board.isPinned(this.fromPos)){var e=this.fromPos.file-this.toPos.file,t=this.fromPos.rank-this.toPos.rank;if(0!==e&&0!==t&&Math.abs(e)!==Math.abs(t))return"Check";var n=this.state.board.getPinnedAxis(this.fromPos);if(0===e&&0!==n)return"Check";if(0===t&&1!==n)return"Check";if(0!==e&&0!==t){if(Math.sign(t)!==Math.sign(e)&&2!==n)return"Check";if(Math.sign(t)===Math.sign(e)&&3!==n)return"Check"}}return 1===this.state.checks&&!this.state.board.isPinned(this.toPos)&&"Check"}},{key:"doChain",value:function(e){Object(j.a)(Object(m.a)(n.prototype),"doChain",this).call(this,e),e.board=e.board.set(this.fromPos,he),e.board=e.board.set(this.toPos,this.piece),(this.state.board.get(this.toPos).isOccupied()||this.piece===this.state.currTurn.PAWN)&&(e.halfMove=0,e.threeFoldDetect=w.b())}}]),n}(N),x=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"doChain",value:function(e){Object(j.a)(Object(m.a)(n.prototype),"doChain",this).call(this,e),e.getColor(this.piece.color).enPassantPos=this.fromPos.addRank(this.piece.color.PAWN_RANK_DIR)}}]),n}(S),R=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"isEnPassant",value:function(){return!0}},{key:"isCapture",value:function(){return!0}},{key:"doChain",value:function(e){Object(j.a)(Object(m.a)(n.prototype),"doChain",this).call(this,e);var t=this.toPos.addRank(-this.piece.color.PAWN_RANK_DIR);C()(t),e.board=e.board.set(t,he)}}]),n}(S),T=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e,r,i,a,o){var s;return Object(c.a)(this,n),(s=t.call(this,e,r,i,a)).promoteChoice=void 0,s.promoteChoice=o,s}return Object(u.a)(n,[{key:"isPromote",value:function(){return!0}},{key:"doChain",value:function(e){Object(j.a)(Object(m.a)(n.prototype),"doChain",this).call(this,e),e.board=e.board.set(this.toPos,this.promoteChoice)}}]),n}(S),K=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e,r){var i;return Object(c.a)(this,n),(i=t.call(this,e)).isKingSide=void 0,i.isKingSide=r,i}return Object(u.a)(n,[{key:"toNotation",value:function(){return new y(this.isKingSide)}},{key:"isCastle",value:function(){return!0}},{key:"doChain",value:function(e){var t=this;Object(j.a)(Object(m.a)(n.prototype),"doChain",this).call(this,e);var r=this.state.currTurn.ROOK,i=this.state.currTurn.KING,a=this.state.currTurn.KING_RANK;e.board=e.board.withMutations((function(e){e.set(new d(4,a),he),t.isKingSide?(e.set(new d(5,a),r),e.set(new d(6,a),i),e.set(new d(7,a),he)):(e.set(new d(3,a),r),e.set(new d(2,a),i),e.set(new d(0,a),he))}))}},{key:"invalid",value:function(){var e=this;if(this.state.isCheck())return"Can't castle out of check";var t=this.state.getColor(this.state.currTurn),n=this.state.currTurn.KING_RANK,r=[];if(this.isKingSide){if(!t.kingSideCastle)return"Can't castle on king side";r.push(new d(5,n),new d(6,n))}else{if(!t.queenSideCastle)return"Can't castle on queen side";r.push(new d(1,n),new d(2,n),new d(3,n))}for(var i=0,a=r;i<a.length;i++){var o=a[i];if(this.state.board.get(o).isOccupied())return"Pieces are between rook and king"}var s=[];return this.isKingSide?(s.push(new d(5,n)),s.push(new d(6,n))):(s.push(new d(2,n)),s.push(new d(3,n))),!!s.some((function(t){return e.state.board.isProtected(t)}))&&"Can't castle into or through check"}}]),n}(N),H=function e(t){if(Object(c.a)(this,e),this.color=void 0,this.queenSideCastle=void 0,this.kingSideCastle=void 0,this.enPassantPos=void 0,t instanceof e){var n=t;this.color=n.color,this.queenSideCastle=n.queenSideCastle,this.kingSideCastle=n.kingSideCastle,this.enPassantPos=n.enPassantPos}else this.color=t,this.queenSideCastle=!0,this.kingSideCastle=!0,this.enPassantPos=null},I=function(){function e(t,n){Object(c.a)(this,e),this.raw=void 0,this.mutable=void 0,this.raw=t,this.mutable=n}return Object(u.a)(e,[{key:"get",value:function(e){switch(15&this.raw[e.toRaw()]){case 0:return he;case 1:return oe.PAWN;case 2:return oe.KNIGHT;case 3:return oe.BISHOP;case 4:return oe.ROOK;case 5:return oe.QUEEN;case 6:return oe.KING;case 9:return se.PAWN;case 10:return se.KNIGHT;case 11:return se.BISHOP;case 12:return se.ROOK;case 13:return se.QUEEN;case 14:return se.KING;default:Object(P.strict)(!1)}}},{key:"getPinnedAxis",value:function(e){return this.raw[e.toRaw()]>>>4&3}},{key:"isPinned",value:function(e){return 64===(64&this.raw[e.toRaw()])}},{key:"isProtected",value:function(e){return 128===(128&this.raw[e.toRaw()])}},{key:"set",value:function(e,t){var n=this.raw[e.toRaw()];return n&=-16,n|=t.id,this.rawSet(e,n)}},{key:"clearFlags",value:function(e){var t=this.raw[e.toRaw()];return t&=15,this.rawSet(e,t)}},{key:"rawSet",value:function(t,n){if(this.mutable)return this.raw[t.toRaw()]=n,this;var r=new Uint8Array(this.raw);return r[t.toRaw()]=n,new e(r,!1)}},{key:"setPinnedAxis",value:function(e,t){var n=this.raw[e.toRaw()];return n&=-49,n|=t<<4,this.rawSet(e,n)}},{key:"setPinned",value:function(e,t){var n=this.raw[e.toRaw()];return n&=-65,n|=Number(t)<<6,this.rawSet(e,n)}},{key:"setProtected",value:function(e,t){var n=this.raw[e.toRaw()];return n&=-129,n|=Number(t)<<7,this.rawSet(e,n)}},{key:"reduce",value:function(e,t){for(var n=0;n<this.raw.length;n++){var r=d.fromRaw(n);t=e(t,this.get(r),r,this)}return t}},{key:"asMutable",value:function(){return new e(new Uint8Array(this.raw),!0)}},{key:"withMutations",value:function(t){var n=new Uint8Array(this.raw);return t(new e(n,!0)),new e(new Uint8Array(n),!1)}}]),e}(),M=function(){function e(t){Object(c.a)(this,e),this.board=void 0,this.white=void 0,this.black=void 0,this.currTurn=void 0,this.moveHistory=void 0,this.historyBegin=void 0,this.halfMove=void 0,this.threeFoldDetect=void 0,this.resign=void 0,this.agreeDraw=void 0,this.checks=void 0,"object"!==typeof t?(this.board=function(){if(!G){for(var e=new Uint8Array(64),t=0;t<64;t++)e[t]=he.id;e.set([oe.ROOK.id,oe.KNIGHT.id,oe.BISHOP.id,oe.QUEEN.id,oe.KING.id,oe.BISHOP.id,oe.KNIGHT.id,oe.ROOK.id],0);for(var n=8;n<16;n++)e[n]=oe.PAWN.id;for(var r=48;r<56;r++)e[r]=se.PAWN.id;e.set([se.ROOK.id,se.KNIGHT.id,se.BISHOP.id,se.QUEEN.id,se.KING.id,se.BISHOP.id,se.KNIGHT.id,se.ROOK.id],56),G=new I(e,!1)}return G}(),this.white=new H(oe),this.black=new H(se),this.currTurn=oe,this.moveHistory=w.a(),this.historyBegin=2,this.halfMove=0,this.threeFoldDetect=w.b(),this.resign=!1,this.agreeDraw=!1,this.checks=0):(this.board=t.board,this.white=new H(t.white),this.black=new H(t.black),this.currTurn=t.currTurn,this.moveHistory=t.moveHistory,this.historyBegin=t.historyBegin,this.halfMove=t.halfMove,this.threeFoldDetect=t.threeFoldDetect,this.resign=t.resign,this.agreeDraw=t.agreeDraw,this.checks=t.checks)}return Object(u.a)(e,[{key:"moveCount",value:function(){return Math.floor((this.historyBegin+this.moveHistory.size)/2)}},{key:"commandPrompt",value:function(){var e="";return this.isGameOver()&&(e="Game Over "),this.currTurn===oe?e+"".concat(this.moveCount(),". WHITE>"):e+"".concat(this.moveCount(),". BLACK>")}},{key:"toFen",value:function(){for(var e="",t=7;t>=0;t--){var n=0;7!==t&&(e+="/");for(var r=0;r<8;r++){var i=this.board.get(new d(r,t));i.isOccupied()?(n&&(e+=String(n),n=0),e+=i.fenLetter):n++}n&&(e+=String(n))}return e+=" ",this.currTurn===oe?e+="w":e+="b",e+=" ",this.white.kingSideCastle&&(e+="K"),this.white.queenSideCastle&&(e+="Q"),this.black.kingSideCastle&&(e+="k"),this.black.queenSideCastle&&(e+="q"),this.white.kingSideCastle||this.white.queenSideCastle||this.black.kingSideCastle||this.black.queenSideCastle||(e+="-"),e+=" ",this.white.enPassantPos?e+=this.white.enPassantPos.toString():this.black.enPassantPos?e+=this.black.enPassantPos.toString():e+="-",e+=" ",e+=String(this.halfMove),e+=" ",e+=String(this.moveCount())}},{key:"toAbvFen",value:function(){var e=this.toFen().split(" ");return e.pop(),e.pop(),e.join(" ")}},{key:"modify",value:function(t){var n=this,r=new e(this);r.board=r.board.asMutable(),t(r),r.board=r.board.asMutable(),r.checks=0,r.board.get(new d(4,0))!==oe.KING&&(r.white.kingSideCastle=!1,r.white.queenSideCastle=!1),r.board.get(new d(0,0))!==oe.ROOK&&(r.white.queenSideCastle=!1),r.board.get(new d(7,0))!==oe.ROOK&&(r.white.kingSideCastle=!1),r.board.get(new d(4,7))!==se.KING&&(r.black.kingSideCastle=!1,r.black.queenSideCastle=!1),r.board.get(new d(0,7))!==se.ROOK&&(r.black.queenSideCastle=!1),r.board.get(new d(7,7))!==se.ROOK&&(r.black.kingSideCastle=!1);var i=!1,a=r.white.enPassantPos;r.black.enPassantPos&&(a=r.black.enPassantPos);var o=function(){if(!a)return"break";if(r.board.get(a)!==he)return"break";if(a.rank!==r.currTurn.OTHER_COLOR.PAWN_RANK-r.currTurn.PAWN_RANK_DIR)return"break";var e=a.addRank(-n.currTurn.PAWN_RANK_DIR);if(r.board.get(e)!==r.currTurn.OTHER_COLOR.PAWN)return"break";var t=a,o=r.modify((function(r){r.white.enPassantPos=null,r.black.enPassantPos=null,r.board.set(e,he),r.board.set(t,n.currTurn.OTHER_COLOR.PAWN)})),s=e.addFile(-1);if(s){var c=o.board.isPinned(s)&&3!==o.board.getPinnedAxis(s);if(o.board.get(s)===n.currTurn.PAWN&&!c)return i=!0,"break"}var u=e.addFile(1);if(u){var h=o.board.isPinned(u)&&2!==o.board.getPinnedAxis(u);o.board.get(u)!==n.currTurn.PAWN||h||(i=!0)}};do{if("break"===o())break}while(0);i||(r.white.enPassantPos=null,r.black.enPassantPos=null);for(var s=0;s<8;s++)for(var c=0;c<8;c++){var u=new d(s,c);r.board.clearFlags(u)}for(var h=0;h<8;h++)for(var l=0;l<8;l++){var f=new d(h,l),b=r.board.get(f);if(b.isOccupied()&&b.color!==r.currTurn){var O,j=b.protects(r,f),m=Object(v.a)(j);try{for(m.s();!(O=m.n()).done;){var k=O.value;r.board.setProtected(k,!0),r.board.get(k)===r.currTurn.KING&&(r.checks++,r.board.setPinned(f,!0))}}catch(p){m.e(p)}finally{m.f()}b.pin(r,f)}}return r.board=r.board.withMutations((function(){})),r}},{key:"getColor",value:function(e){switch(e){case oe:return this.white;case se:return this.black;default:throw new Error("Not a color")}}},{key:"flipTurn",value:function(){return this.modify((function(e){return e.currTurn=e.currTurn.OTHER_COLOR,e.getColor(e.currTurn).enPassantPos=null,e}))}},{key:"moves",value:function(){for(var e=[],t=0;t<8;t++)for(var n=0;n<8;n++){var r=new d(t,n),i=this.board.get(r);i.isOccupied()&&i.color===this.currTurn&&(e=e.concat(i.moves(this,r)))}return e.push(new K(this,!0),new K(this,!1)),e}},{key:"isDraw",value:function(){return this.agreeDraw||!this.isCheckmate()&&!this.moves().some((function(e){return!e.invalid()}))||this.isThreeFold()||this.halfMove>=100}},{key:"isGameOver",value:function(){return!this.moves().some((function(e){return!e.invalid()}))||this.isDraw()||this.resign}},{key:"drawReason",value:function(){return this.isThreeFold()?"three fold repetition":this.halfMove>=100?"50 move rule":"stalemate"}},{key:"isThreeFold",value:function(){var e=this.toAbvFen();return Number(this.threeFoldDetect.get(e))>=2}},{key:"isCheck",value:function(){return 0!==this.checks}},{key:"isCheckmate",value:function(){return!this.moves().some((function(e){return!e.invalid()}))&&this.isCheck()}},{key:"back",value:function(){return 0===this.moveHistory.size?this:Object.freeze(new A(this.moveHistory.last(void 0).state,this.moveHistory,this.moveHistory.size-1))}},{key:"forward",value:function(){return this}},{key:"endAltHistory",value:function(){return this}},{key:"isHistory",value:function(){return!1}},{key:"perft",value:function(e){if(0===e)return 1;var t,n=this.moves().filter((function(e){return!e.invalid()})),r=0,i=Object(v.a)(n);try{for(i.s();!(t=i.n()).done;){r+=t.value.do().perft(e-1)}}catch(a){i.e(a)}finally{i.f()}return r}},{key:"toPGN",value:function(e,t,n,r,i,a){""===(t=t.trim())&&(t="Casual Game"),""===(n=n.trim())&&(n="Local Game"),""===(r=r.trim())&&(r="-"),""===(i=i.trim())&&(i="Unknown"),""===(a=a.trim())&&(a="Unknown");var o="".concat(e.getFullYear(),".").concat(e.getMonth(),".").concat(e.getDate()),s=this.endAltHistory().end(),c="*";s.isGameOver()&&(c=s.isDraw()?"1/2-1/2":s.currTurn===oe?"0-1":"1-0");var u=[["Event",t],["Site",n],["Date",o],["Round",r],["White",i],["Black",a],["Result",c]],h=s.begin();h.toFen()!==W().toFen()&&(u.push(["SetUp","1"]),u.push(["FEN",h.toFen()]));for(var l="",d=0,b=u;d<b.length;d++){var O=b[d];l+="[".concat(O[0],' "').concat(O[1],'"]\n')}var j=new f,m=h.historyBegin;m%2===1&&j.addToken("".concat(Math.floor(m/2),"..."));var k,p=Object(v.a)(s.moveHistory);try{for(p.s();!(k=p.n()).done;){var y=k.value;m%2===0&&j.addToken("".concat(Math.floor(m/2),".")),m++,j.addToken(y.toNotation().toString())}}catch(g){p.e(g)}finally{p.f()}return j.addToken(c),l+j.done()+"\n"}},{key:"begin",value:function(){for(var e=this,t=this.back();t!==e;)e=t,t=t.back();return t}},{key:"end",value:function(){for(var e=this,t=this.forward();t!==e;)e=t,t=t.forward();return t}}]),e}(),A=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e,r,i){var a;return Object(c.a)(this,n),(a=t.call(this,e)).moveIndex=void 0,a.moveHistory=r,a.moveIndex=i,a}return Object(u.a)(n,[{key:"moveCount",value:function(){return Math.floor((this.moveIndex+this.historyBegin)/2)}},{key:"back",value:function(){if(0===this.moveIndex)return this;var e=this.moveIndex-1,t=this.moveHistory.get(e).state;return t.isHistory()?t:Object.freeze(new n(t,this.moveHistory,e))}},{key:"forward",value:function(){if(this.moveIndex>=this.moveHistory.size-1)return this.moveHistory.last(void 0).do();var e=this.moveIndex+1,t=this.moveHistory.get(e).state;return t.isHistory()?t:Object.freeze(new n(t,this.moveHistory,e))}},{key:"modify",value:function(e){var t=new B(this,this.moveHistory,this.moveIndex);return e(t),Object.freeze(t.white),Object.freeze(t.black),Object.freeze(t)}},{key:"commandPrompt",value:function(){return this.currTurn===oe?"History ".concat(this.moveCount(),". WHITE>"):"History ".concat(this.moveCount(),". BLACK>")}},{key:"isHistory",value:function(){return!0}}]),n}(M),B=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e,r,i){var a;return Object(c.a)(this,n),(a=t.call(this,e,r,i)).altBranch=void 0,a.altBranch=e instanceof n?e.altBranch:e,a}return Object(u.a)(n,[{key:"endAltHistory",value:function(){return this.altBranch}},{key:"commandPrompt",value:function(){return this.currTurn===oe?"Alt History ".concat(this.moveCount(),". WHITE>"):"Alt History ".concat(this.moveCount(),". BLACK>")}}]),n}(A),E=null,G=null;function W(){return E||(E=(new M).modify((function(e){return e}))),E}var F=/^((?:[kqnbrpKQNBRP1-8]+\/){7}[kqnbrpKQNBRP1-8]+)\s+([bw])\s+(KQ?k?q?|Qk?q?|kq?|q|-)\s+((?:[a-h][36])|-)\s+(\d+)\s+(\d+)$/;function D(e){for(var t=new Uint8Array(64),n=0;n<64;n++)t[n]=he.id;var r=7,i=F.exec(e.trim());if(!i)throw new Error("Fen syntax error");var a,o=i[1].split("/"),s=Object(v.a)(o);try{for(s.s();!(a=s.n()).done;){var c,u=a.value,f=0,b=Object(v.a)(u);try{for(b.s();!(c=b.n()).done;){var O=c.value;if(f>=8)throw new Error("Fen board has too many pieces on one row");var j=Number(O);j?f+=j:(t[new d(f,r).toRaw()]=ue.get(O).id,f++)}}catch(S){b.e(S)}finally{b.f()}if(f<7)throw new Error("Fen board has too little pieces on one row");if(f>8)throw new Error("Fen board has too many pieces on one row");r--}}catch(S){s.e(S)}finally{s.f()}var m=oe;"b"===i[2]&&(m=se);var k=new H(oe);k.kingSideCastle=i[3].includes("K"),k.queenSideCastle=i[3].includes("Q");var p=new H(se);p.kingSideCastle=i[3].includes("k"),p.queenSideCastle=i[3].includes("q");var y=i[4];if("-"!==y){var g=p;m===se&&(g=k);var w=h(y[0]),P=l(y[1]);g.enPassantPos=new d(w,P)}var C=Number(i[5]),N=2*Number(i[6]);if(0===N)throw new Error("Chess games start on move 1");return m===se&&N++,W().modify((function(e){e.board=new I(t,!1),e.white=k,e.black=p,e.currTurn=m,e.historyBegin=N,e.halfMove=C}))}var _=function e(){Object(c.a)(this,e)},L=function e(t){if(Object(c.a)(this,e),this.id=0,"function"!==typeof this.isOccupied)throw new Error("isOccupied function not defined");if("function"!==typeof this.canMoveOnto)throw new Error("canMoveOnto function not defined");if("function"!==typeof this.canBeCaptured)throw new Error("canBeCaptured function not defined")},q=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"isOccupied",value:function(){return!1}},{key:"canMoveOnto",value:function(e){return!0}},{key:"canBeCaptured",value:function(e){return!1}}]),n}(L);function Q(e,t,n,r){for(var i=[],a=n.add(r[0],r[1]);a&&e.board.get(a).canMoveOnto(t)&&(i.push(new S(e,t,n,a)),!e.board.get(a).canBeCaptured(t));)a=a.add(r[0],r[1]);return i}function U(e,t,n,r){for(var i=[],a=n.add(r[0],r[1]);a&&e.board.get(a).canMoveOnto(t);){i.push(a);var o=e.board.get(a);if(o.canBeCaptured(t)&&o!==e.currTurn.KING)break;a=a.add(r[0],r[1])}return a&&i.push(a),i}function z(e,t,n){for(var r=t.add(n[0],n[1]);r&&e.board.get(r)!==e.currTurn.KING;)e.board.setPinned(r,!0),r=r.add(n[0],n[1])}function J(e,t,n,r){for(var i=n.add(r[0],r[1]);i&&e.board.get(i).canMoveOnto(t);){if(e.board.get(i)===e.currTurn.KING)return!0;if(e.board.get(i).canBeCaptured(t))break;i=i.add(r[0],r[1])}return!1}function $(e,t,n,r){for(var i=n.add(r[0],r[1]);i&&e.board.get(i).canMoveOnto(t);){if(e.board.get(i).canBeCaptured(t)){if(e.board.get(i)===e.currTurn.KING)z(e,n,r);else if(J(e,t,i,r)){e.board.setPinned(i,!0);var a=0;1===r[0]&&0===r[1]||-1===r[0]&&0===r[1]?a=1:-1===r[0]&&1===r[1]||1===r[0]&&-1===r[1]?a=2:(-1===r[0]&&-1===r[1]||1===r[0]&&1===r[1])&&(a=3),e.board.setPinnedAxis(i,a)}break}i=i.add(r[0],r[1])}}var Y=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e,r,i,a){var o;if(Object(c.a)(this,n),(o=t.call(this,e)).color=void 0,o.fenLetter=void 0,"function"!==typeof o.moves)throw new Error("Moves function not defined");if("function"!==typeof o.getPGNLetter)throw new Error("Get pgn letter not defined");return o.color=r,o.fenLetter=i,o.id=a,o}return Object(u.a)(n,[{key:"isOccupied",value:function(){return!0}},{key:"canMoveOnto",value:function(e){return this.color!==e.color}},{key:"canBeCaptured",value:function(e){return this.canMoveOnto(e)}},{key:"pin",value:function(e,t){}}]),n}(L),Z=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"addMove",value:function(e,t,n,r){if(r.rank===this.color.OTHER_COLOR.KING_RANK){var i,a=Object(v.a)(this.color.PROMOTE_LIST);try{for(a.s();!(i=a.n()).done;){var o=i.value;t.push(new T(e,this,n,r,o))}}catch(s){a.e(s)}finally{a.f()}}else t.push(new S(e,this,n,r))}},{key:"getPGNLetter",value:function(){return""}},{key:"moves",value:function(e,t){var n=[],r=t.addRank(this.color.PAWN_RANK_DIR);if(!r)return n;var i=e.board.get(r).isOccupied();if(i||this.addMove(e,n,t,r),!i&&this.color.PAWN_RANK===t.rank){var a=t.addRank(2*this.color.PAWN_RANK_DIR);console.assert(a,"First move should be in bounds"),e.board.get(a).isOccupied()||n.push(new x(e,this,t,a))}var o=e.getColor(this.color.OTHER_COLOR),s=t.add(-1,this.color.PAWN_RANK_DIR);s&&e.board.get(s).canBeCaptured(this)&&this.addMove(e,n,t,s);var c=t.add(1,this.color.PAWN_RANK_DIR);return c&&e.board.get(c).canBeCaptured(this)&&this.addMove(e,n,t,c),o.enPassantPos&&(s&&0===o.enPassantPos.compare(s)&&n.push(new R(e,this,t,s)),c&&0===o.enPassantPos.compare(c)&&n.push(new R(e,this,t,c))),n}},{key:"protects",value:function(e,t){var n=[],r=t.add(-1,this.color.PAWN_RANK_DIR);r&&n.push(r);var i=t.add(1,this.color.PAWN_RANK_DIR);return i&&n.push(i),n}}]),n}(Y),V=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"moves",value:function(e,t){var n=this;return[[0,1],[0,-1],[1,0],[-1,0]].map((function(r){return Q(e,n,t,r)})).reduce((function(e,t){return e.concat(t)}))}},{key:"getPGNLetter",value:function(){return"R"}},{key:"pin",value:function(e,t){var n=this;return[[0,1],[0,-1],[1,0],[-1,0]].forEach((function(r){return $(e,n,t,r)}))}},{key:"protects",value:function(e,t){var n=this;return[[0,1],[0,-1],[1,0],[-1,0]].map((function(r){return U(e,n,t,r)})).reduce((function(e,t){return e.concat(t)}))}}]),n}(Y),X=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"moves",value:function(e,t){for(var n=[],r=0,i=[[1,2],[-1,2],[1,-2],[-1,-2],[2,1],[-2,1],[2,-1],[-2,-1]];r<i.length;r++){var a=i[r],o=t.add(a[0],a[1]);o&&e.board.get(o).canMoveOnto(this)&&n.push(new S(e,this,t,o))}return n}},{key:"protects",value:function(e,t){for(var n=[],r=0,i=[[1,2],[-1,2],[1,-2],[-1,-2],[2,1],[-2,1],[2,-1],[-2,-1]];r<i.length;r++){var a=i[r],o=t.add(a[0],a[1]);o&&n.push(o)}return n}},{key:"getPGNLetter",value:function(){return"N"}}]),n}(Y),ee=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"moves",value:function(e,t){var n=this;return[[1,1],[-1,-1],[1,-1],[-1,1]].map((function(r){return Q(e,n,t,r)})).reduce((function(e,t){return e.concat(t)}))}},{key:"getPGNLetter",value:function(){return"B"}},{key:"pin",value:function(e,t){var n=this;return[[1,1],[-1,-1],[1,-1],[-1,1]].forEach((function(r){return $(e,n,t,r)}))}},{key:"protects",value:function(e,t){var n=this;return[[1,1],[-1,-1],[1,-1],[-1,1]].map((function(r){return U(e,n,t,r)})).reduce((function(e,t){return e.concat(t)}))}}]),n}(Y),te=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"moves",value:function(e,t){return ee.prototype.moves.call(this,e,t).concat(V.prototype.moves.call(this,e,t))}},{key:"getPGNLetter",value:function(){return"Q"}},{key:"pin",value:function(e,t){ee.prototype.pin.call(this,e,t),V.prototype.pin.call(this,e,t)}},{key:"protects",value:function(e,t){return ee.prototype.protects.call(this,e,t).concat(V.prototype.protects.call(this,e,t))}}]),n}(Y),ne=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"moves",value:function(e,t){for(var n=[],r=0,i=[[1,0],[1,1],[-1,0],[-1,-1],[1,-1],[-1,1],[0,1],[0,-1]];r<i.length;r++){var a=i[r],o=t.add(a[0],a[1]);o&&e.board.get(o).canMoveOnto(this)&&n.push(new S(e,this,t,o))}return n}},{key:"protects",value:function(e,t){for(var n=[],r=0,i=[[1,0],[1,1],[-1,0],[-1,-1],[1,-1],[-1,1],[0,1],[0,-1]];r<i.length;r++){var a=i[r],o=t.add(a[0],a[1]);o&&n.push(o)}return n}},{key:"getPGNLetter",value:function(){return"K"}}]),n}(Y);function re(e,t,n,r,i){var a={},o=new _;Object.assign(a,{PAWN:Object.freeze(new Z(o,a,r("P"),1+i)),KNIGHT:Object.freeze(new X(o,a,r("N"),2+i)),BISHOP:Object.freeze(new ee(o,a,r("B"),3+i)),ROOK:Object.freeze(new V(o,a,r("R"),4+i)),QUEEN:Object.freeze(new te(o,a,r("Q"),5+i)),KING:Object.freeze(new ne(o,a,r("K"),6+i)),KING_RANK:e,PAWN_RANK:t,PAWN_RANK_DIR:n}),a.PROMOTE_LIST=Object.freeze([a.QUEEN,a.KNIGHT,a.ROOK,a.BISHOP]);var s=[["K",a.KING],["Q",a.QUEEN],["R",a.ROOK],["B",a.BISHOP],["N",a.KNIGHT],["",a.PAWN]];return a.FROM_LETTER=w.b(s),a}var ie=re(0,1,1,(function(e){return e}),0),ae=re(7,6,-1,(function(e){return e.toLowerCase()}),8);ie.OTHER_COLOR=ae,Object.freeze(ie),ae.OTHER_COLOR=ie,Object.freeze(ae);var oe=ie,se=ae,ce=[["K",oe.KING],["Q",oe.QUEEN],["R",oe.ROOK],["B",oe.BISHOP],["N",oe.KNIGHT],["P",oe.PAWN],["k",se.KING],["q",se.QUEEN],["r",se.ROOK],["b",se.BISHOP],["n",se.KNIGHT],["p",se.PAWN]],ue=w.b(ce),he=Object.freeze(new q(new _)),le=n(0);function de(e,t){var n=function(e){switch(e){case oe.QUEEN:return"White Queen";case oe.KING:return"White King";case oe.BISHOP:return"White Bishop";case oe.ROOK:return"White Rook";case oe.KNIGHT:return"White Knight";case oe.PAWN:return"White Pawn";case se.QUEEN:return"Black Queen";case se.KING:return"Black King";case se.BISHOP:return"Black Bishop";case se.ROOK:return"Black Rook";case se.KNIGHT:return"Black Knight";case se.PAWN:return"Black Pawn"}}(t);if(n)return Object(le.jsx)("img",{alt:n,className:"ChessPiece",src:"".concat("/yachessjs","/pieces/").concat(e.piece.prefix,"/").concat(n,".svg")})}function fe(e){var t,n,r="ChessBoardSquare ".concat(e.theme.className);e.isBlack?r+=" ChessBoardSquareBlack":r+=" ChessBoardSquareWhite",e.highlighted&&(t=Object(le.jsx)("svg",{className:"Overlay",children:Object(le.jsx)("rect",{width:"100%",height:"100%",fill:"yellow",fillOpacity:".5"})})),e.inCheck&&(n=Object(le.jsx)("svg",{className:"Overlay",children:Object(le.jsx)("rect",{width:"100%",height:"100%",fill:"red",fillOpacity:".5"})}));var i,a=de(e.theme.theme,e.piece);return e.canMoveTo&&!a&&(i=Object(le.jsx)("svg",{className:"Overlay",children:Object(le.jsx)("circle",{r:"10%",cx:"50%",cy:"50%"})})),e.canMoveTo&&a&&(i=Object(le.jsx)("svg",{className:"Overlay",children:Object(le.jsx)("circle",{r:"47.5%",cx:"50%",cy:"50%",fill:"none",stroke:"black",strokeWidth:"2.5%"})})),Object(le.jsxs)("div",{className:r,onClick:e.onClick,children:[t,n,a,i,e.children]})}function ve(e){var t,n=[],r=0,i=Object(v.a)(e.moves);try{var a=function(){var i=t.value;n.push(Object(le.jsx)(fe,{piece:i.promoteChoice,onClick:function(){e.onPromote(i.do())},theme:e.theme},r++))};for(i.s();!(t=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return Object(le.jsx)("div",{className:"PromoteMenu",children:n})}function be(e){var t,n=Object(r.useState)(null),i=Object(s.a)(n,2),a=i[0],o=i[1],c=e.highlightedPos;e.changeHighlight&&c&&(!e.state.board.get(c).isOccupied()||(null===(t=e.setup)||void 0===t?void 0:t.setupPiece))&&e.changeHighlight(void 0),!c&&a&&o(null);var u=[],h=!1,l=[],f=a;if(f&&e.state.currTurn===se&&(f=f.addRank(3)),c&&e.makeMove){var v=function(t){return!t.invalid()&&!e.state.isGameOver()&&(t.isNormal()?0===t.fromPos.compare(c):!!t.isCastle()&&(c.rank===e.state.currTurn.KING_RANK&&4===c.file))};l=e.state.moves().filter(v),e.setup&&(l=l.concat(e.state.flipTurn().moves().filter(v)))}for(var b=7;b>=0;b--){h=!h;for(var O=function(t){h=!h;var n=new d(t,b),r=Boolean(c&&0===n.compare(c)),i=e.state.board.get(new d(t,b)),s=i===e.state.currTurn.KING&&e.state.isCheck(),v=l.findIndex((function(t){return t.isNormal()?0===t.toPos.compare(n):!!t.isCastle()&&(n.rank===e.state.currTurn.KING_RANK&&(t.isKingSide?7===n.file||6===n.file:2===n.file||0===n.file))})),O=function(){e.changeHighlight&&e.changeHighlight(void 0),o(null)},j=l[v];if(c&&0===n.compare(c));else if(c&&e.makeMove&&e.setup){var m=e.makeMove;O=function(){m(e.state.modify((function(e){var t=e.board.get(c);e.board=e.board.set(c,he),e.board=e.board.set(n,t)}))),e.changeHighlight&&e.changeHighlight(void 0),o(null)}}else if(e.setup&&e.setup.setupPiece&&e.makeMove){var k=e.makeMove,p=e.setup.setupPiece;O=function(){k(e.state.modify((function(e){e.board=e.board.set(n,p)}))),e.changeHighlight&&e.changeHighlight(void 0)}}else if(-1===v&&i.isOccupied())O=function(){e.changeHighlight&&e.changeHighlight(n),o(null)};else if(v>=0&&(j.isNormal()&&!j.isPromote()||j.isCastle()))O=function(){e.makeMove(l[v].do()),e.changeHighlight&&e.changeHighlight(void 0),o(null)};else if(v>=0&&j.isNormal()&&j.isPromote()&&!a){var y=j;O=function(){o(y.toPos)}}var g=void 0;if(f&&0===n.compare(f)){var P=w.a(l.filter((function(e){return!(!e.isNormal()||!a||0!==e.toPos.compare(a))&&e.isPromote()})));g=Object(le.jsx)(ve,{moves:P,onPromote:function(t){e.makeMove(t),e.changeHighlight&&e.changeHighlight(void 0),o(null)},theme:e.theme})}var C=v>=0&&!a;u.push(Object(le.jsx)(fe,{canMoveTo:C,isBlack:h,piece:i,highlighted:r,inCheck:s,onClick:O,theme:e.theme,children:g},8*b+t))},j=0;j<8;j++)O(j)}return Object(le.jsx)("div",{className:"Square",children:Object(le.jsx)("div",{className:"ChessBoard",children:u})})}var Oe=n(12);function je(e){var t=Object(Oe.a)({},e);return delete t.label,t.className?t.className+=" ":t.className="",t.className+="LabelledTextboxTextbox",Object(le.jsxs)("div",{className:"LabelledTextbox",children:[Object(le.jsx)("label",{children:e.label}),Object(le.jsx)("input",Object(Oe.a)({},t))]})}function me(e){var t=new URLSearchParams(e.location.search).get("fen");if(t)try{return D(t)}catch(n){}return W()}function ke(e,t,n,r,i){var a=Object(Oe.a)({},t),o=new URLSearchParams(a.search),s=n.toFen();a.pathname="/yachessjs"+r,s===W().toFen()?o.delete("fen"):o.set("fen",n.toFen()),a.search=o.toString(),i?e.replace(a):e.push(a)}var pe=n(7);function ye(e){var t=Object(r.useState)((function(){return e.state.toFen()})),n=Object(s.a)(t,2),i=n[0],a=n[1],o=Object(r.useState)(),c=Object(s.a)(o,2),u=c[0],h=c[1],l=Object(pe.g)(),f=Object(pe.h)(),v=0,b=[],O=!1;function j(e,t){e&&(O=!0,b.push(Object(le.jsx)("p",{className:"ErrorText",children:t},v))),v++}j(u,u),j(e.state.isCheckmate(),"Setup state is mate"),j(e.state.flipTurn().isCheck(),"The king is captured");var m=e.state.board.reduce((function(e,t){return e+Number(t===oe.KING)}),0),k=e.state.board.reduce((function(e,t){return e+Number(t===se.KING)}),0);j(0===m,"White needs a king"),j(m>1,"White has more than one king"),j(0===k,"Black needs a king"),j(k>1,"Black has more than one king");var p=e.state.board.reduce((function(e,t,n){return e+Number((0===n.rank||7===n.rank)&&(t===oe.PAWN||t===se.PAWN))}),0);function y(t,n){var r=t===e.selectedPiece;return Object(le.jsx)(fe,{piece:t,highlighted:r,onClick:function(){t===e.selectedPiece?e.selectPiece():e.selectPiece(t)},theme:e.theme},n)}j(1===p,"There is a pawn on the back rank"),j(p>1,"There are ".concat(p," pawns on the back rank"));var g=[se.PAWN,se.KNIGHT,se.BISHOP,se.ROOK,se.QUEEN,se.KING].map(y),w=[oe.PAWN,oe.KNIGHT,oe.BISHOP,oe.ROOK,oe.QUEEN,oe.KING].map(y),P="white";e.state.currTurn===se&&(P="black");var C="";return e.state.white.enPassantPos?C=String(e.state.white.enPassantPos.file):e.state.black.enPassantPos&&(C=String(e.state.black.enPassantPos.file)),Object(le.jsxs)("div",{className:"SetupInfo",children:[Object(le.jsx)("div",{className:"SetupErrorBox",children:b}),Object(le.jsx)("div",{className:"SetupPieceBox",children:g}),Object(le.jsx)("div",{className:"SetupPieceBox",children:w}),Object(le.jsx)(je,{value:e.state.toFen(),type:"text",readOnly:!0,label:"Current Fen:"}),Object(le.jsx)(je,{label:"Input Fen:",onChange:function(e){a(e.target.value)},value:i}),Object(le.jsxs)("div",{children:[Object(le.jsx)("label",{children:"First Move: "}),Object(le.jsxs)("select",{value:P,onChange:function(t){var n=oe;"black"===t.target.value&&(n=se),n!==e.state.currTurn&&e.changeState(e.state.flipTurn())},children:[Object(le.jsx)("option",{value:"white",children:"White"}),Object(le.jsx)("option",{value:"black",children:"Black"})]})]}),Object(le.jsxs)("div",{children:[Object(le.jsx)("label",{children:"En-passant file: "}),Object(le.jsxs)("select",{value:C,onChange:function(t){e.changeState(e.state.modify((function(e){var n=5;e.currTurn===se&&(n=2);var r=e.getColor(e.currTurn.OTHER_COLOR);t.target.value&&(r.enPassantPos=new d(Number(t.target.value),n))})))},children:[Object(le.jsx)("option",{value:"",children:"-"}),Object(le.jsx)("option",{value:"0",children:"a"}),Object(le.jsx)("option",{value:"1",children:"b"}),Object(le.jsx)("option",{value:"2",children:"c"}),Object(le.jsx)("option",{value:"3",children:"d"}),Object(le.jsx)("option",{value:"4",children:"e"}),Object(le.jsx)("option",{value:"5",children:"f"}),Object(le.jsx)("option",{value:"6",children:"g"}),Object(le.jsx)("option",{value:"7",children:"h"})]})]}),Object(le.jsxs)("div",{children:[Object(le.jsx)("label",{children:"White O-O: "}),Object(le.jsx)("input",{type:"checkbox",checked:e.state.white.kingSideCastle,onChange:function(t){e.changeState(e.state.modify((function(e){e.white.kingSideCastle=t.target.checked})))}})]}),Object(le.jsxs)("div",{children:[Object(le.jsx)("label",{children:"White O-O-O: "}),Object(le.jsx)("input",{type:"checkbox",checked:e.state.white.queenSideCastle,onChange:function(t){e.changeState(e.state.modify((function(e){e.white.queenSideCastle=t.target.checked})))}})]}),Object(le.jsxs)("div",{children:[Object(le.jsx)("label",{children:"Black O-O: "}),Object(le.jsx)("input",{type:"checkbox",checked:e.state.black.kingSideCastle,onChange:function(t){e.changeState(e.state.modify((function(e){e.black.kingSideCastle=t.target.checked})))}})]}),Object(le.jsxs)("div",{children:[Object(le.jsx)("label",{children:"Black O-O-O: "}),Object(le.jsx)("input",{type:"checkbox",checked:e.state.black.queenSideCastle,onChange:function(t){e.changeState(e.state.modify((function(e){e.black.queenSideCastle=t.target.checked})))}})]}),Object(le.jsxs)("div",{children:[Object(le.jsx)("button",{onClick:function(){try{e.changeState(D(i)),h(void 0)}catch(t){h(t.toString())}},children:"Import Fen"}),Object(le.jsx)("button",{onClick:function(){e.changeState(W())},children:"Reset"}),Object(le.jsx)("button",{onClick:function(){e.changeState(D("8/8/8/8/8/8/8/8 w - - 0 1"))},children:"Clear"})]}),Object(le.jsx)("button",{disabled:O,onClick:function(){ke(l,f,e.state,"/play",!1)},children:"Play"}),Object(le.jsx)("button",{onClick:e.openTheme,children:"Change Theme"})]})}function ge(e){var t=Object(pe.g)(),n=Object(r.useState)(),i=Object(s.a)(n,2),a=i[0],o=i[1],c=Object(r.useState)(),u=Object(s.a)(c,2),h=u[0],l=u[1],d=me(t),f=Object(pe.h)();function v(e){ke(t,f,e,"/setup",!0)}var b=function(e){return v(e)};var O={setupPiece:h};return Object(le.jsxs)("div",{className:"App",children:[Object(le.jsx)("div",{className:"PlayChessBoardBox",children:Object(le.jsx)(be,{changeHighlight:function(e){o(e),l(void 0)},highlightedPos:a,state:d,setup:O,makeMove:b,theme:e.theme})}),Object(le.jsx)(ye,{changeState:b,selectPiece:function(e){a?v(d.modify((function(e){e.board=e.board.set(a,he)}))):l(e),o(void 0)},selectedPiece:h,state:d,theme:e.theme,openTheme:e.openTheme})]})}var we=n(22),Pe=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,[{key:"getBoardClick",value:function(){}},{key:"close",value:function(){}},{key:"newGame",value:function(){}}]),e}(),Ce=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).promiseRes=void 0,e}return Object(u.a)(n,[{key:"makeMove",value:function(e){var t=this;return new Promise((function(e){t.promiseRes=e}))}},{key:"name",value:function(){return"Human"}},{key:"getBoardClick",value:function(){return this.promiseRes}}]),n}(Pe),Ne=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).timeoutID=void 0,e}return Object(u.a)(n,[{key:"makeMove",value:function(e){var t=this,n=e.moves().filter((function(e){return!e.invalid()})),r=n[Math.floor(Math.random()*n.length)];return new Promise((function(e){t.timeoutID=window.setTimeout((function(){return e(r.do())}),100)}))}},{key:"name",value:function(){return"MrRandom"}},{key:"close",value:function(){clearTimeout(this.timeoutID)}}]),n}(Pe),Se=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this)).stockfishHandle=void 0,r.state=void 0,r.resolve=void 0,r.level=void 0,r.level=e,r.parseStockfishLine=r.parseStockfishLine.bind(Object(we.a)(r)),r}return Object(u.a)(n,[{key:"name",value:function(){return"Stockfish"}},{key:"makeMove",value:function(e){var t=this;return new Promise((function(n){if(t.state=e,t.stockfishHandle)t.giveStateToStockfish();else{var r="object"===typeof WebAssembly&&WebAssembly.validate(Uint8Array.of(0,97,115,109,1,0,0,0));t.stockfishHandle=new Worker(r?"/yachessjs/stockfish.js/stockfish.wasm.js":"/yachessjs/stockfish.js/stockfish.js"),t.stockfishHandle.addEventListener("message",t.parseStockfishLine),t.stockfishHandle.postMessage("uci")}t.resolve=n}))}},{key:"giveStateToStockfish",value:function(){var e;this.stockfishHandle.postMessage("position fen ".concat(null===(e=this.state)||void 0===e?void 0:e.toFen())),this.stockfishHandle.postMessage("go movetime 5000")}},{key:"parseStockfishLine",value:function(e){var t=this,n=e.data.split(/\s+/).map((function(e){return e.trim()})).filter((function(e){return e}));switch(n[0]){case"uciok":this.stockfishHandle.postMessage("setoption name Skill Level value ".concat(this.level)),this.stockfishHandle.postMessage("ucinewgame"),this.giveStateToStockfish();break;case"bestmove":var r,i=n[1],a=new d(h(i[0]),l(i[1])),o=new d(h(i[2]),l(i[3]));i[4]&&(r=this.state.currTurn.FROM_LETTER.get(i[4].toUpperCase()));var s=this.state.moves().filter((function(e){if(e.isCastle()&&a.rank===t.state.currTurn.KING_RANK&&o.rank===a.rank&&4===a.file){if(e.isKingSide&&6===o.file)return!0;if(!e.isKingSide&&2===o.file)return!0}return!(!e.isNormal()||0!==e.fromPos.compare(a)||0!==e.toPos.compare(o))&&(!e.isPromote()||r===e.promoteChoice)}));this.resolve(s[0].do())}}},{key:"close",value:function(){this.stockfishHandle&&this.stockfishHandle.terminate()}}]),n}(Pe),xe=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,[{key:"difficulty",value:function(){}},{key:"setDifficulty",value:function(e){return this}},{key:"minDifficulty",value:function(){}},{key:"maxDifficulty",value:function(){}}]),e}(),Re=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"name",value:function(){return"Human"}},{key:"build",value:function(){return new Ce}},{key:"id",value:function(){return"human"}}]),n}(xe),Te=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(u.a)(n,[{key:"name",value:function(){return"Mr. Random"}},{key:"build",value:function(){return new Ne}},{key:"id",value:function(){return"random"}}]),n}(xe),Ke=function(e){Object(b.a)(n,e);var t=Object(O.a)(n);function n(e){var r;return Object(c.a)(this,n),(r=t.call(this)).rawDifficulty=void 0,r.rawDifficulty=e||0,r}return Object(u.a)(n,[{key:"difficulty",value:function(){return this.rawDifficulty}},{key:"minDifficulty",value:function(){return 0}},{key:"maxDifficulty",value:function(){return 20}},{key:"setDifficulty",value:function(e){return new n(e)}},{key:"name",value:function(){return"Stockfish"}},{key:"build",value:function(){return new Se(this.rawDifficulty)}},{key:"id",value:function(){return"stockfish"}}]),n}(xe);function He(e){var t;return void 0!==e.value.difficulty()&&(t=Object(le.jsxs)(le.Fragment,{children:[Object(le.jsx)("br",{}),Object(le.jsxs)("label",{children:[e.value.name()," Level: ",e.value.difficulty()]}),Object(le.jsx)("br",{}),Object(le.jsx)("input",{type:"range",min:e.value.minDifficulty(),max:e.value.maxDifficulty(),onChange:function(t){var n=Number(t.target.value);e.onPlayerChange(e.value.setDifficulty(n))},value:e.value.difficulty()})]})),Object(le.jsxs)(le.Fragment,{children:[Object(le.jsxs)("select",{value:e.value.id(),onChange:function(t){var n;switch(t.target.value){case"human":n=new Re;break;case"random":n=new Te;break;case"stockfish":n=new Ke;break;default:return}e.onPlayerChange(n)},children:[Object(le.jsx)("option",{value:"human",children:"Human"}),Object(le.jsx)("option",{value:"random",children:"MrRandom"}),Object(le.jsx)("option",{value:"stockfish",children:"Stockfish"})]}),t]})}function Ie(e){var t,n=Object(r.useState)(new Re),i=Object(s.a)(n,2),a=i[0],o=i[1],c=Object(r.useState)(new Re),u=Object(s.a)(c,2),h=u[0],l=u[1];return e.state.isCheckmate()?t="Checkmate":e.state.isDraw()&&(t="Draw due to ".concat(e.state.drawReason())),Object(le.jsxs)("div",{className:"GameInfo",children:[t,Object(le.jsx)("br",{}),Object(le.jsx)("label",{children:"White Player "}),Object(le.jsx)(He,{onPlayerChange:function(e){o(e)},value:a}),Object(le.jsx)("br",{}),Object(le.jsx)("label",{children:"Black Player "}),Object(le.jsx)(He,{onPlayerChange:function(e){l(e)},value:h}),Object(le.jsx)("br",{}),Object(le.jsx)("button",{onClick:function(){e.restart(a.build(),h.build())},children:"Restart"}),Object(le.jsx)("button",{onClick:e.switchMode,children:"Setup"}),Object(le.jsx)("button",{onClick:e.openTheme,children:"Change Theme"})]})}function Me(e){var t=Object(pe.g)(),n=Object(pe.h)(),i=Object(r.useState)({white:new Ce,black:new Ce}),a=Object(s.a)(i,2),o=a[0],c=a[1],u=Object(r.useState)((function(){return me(t)})),h=Object(s.a)(u,2),l=h[0],d=h[1],f=Object(r.useState)(),v=Object(s.a)(f,2),b=v[0],O=v[1];Object(r.useEffect)((function(){var e=me(t),n=!0,r=o.white,i=o.black;if(e.currTurn===se){var a=r;r=i,i=a}return r.makeMove(e).then((function e(t){if(n){if(!t.isGameOver()){var a=r;r=i,i=a;var o=r.makeMove(t).then(e);return d(t),o}d(t)}})),d(e),function(){n=!1,o.white.close(),o.black.close()}}),[o]);var j=o.white;return l.currTurn===se&&(j=o.black),Object(le.jsxs)("div",{className:"App",children:[Object(le.jsx)("div",{className:"PlayChessBoardBox",children:Object(le.jsx)(be,{changeHighlight:O,highlightedPos:b,makeMove:j.getBoardClick(),state:l,theme:e.theme})}),Object(le.jsx)(Ie,{state:l,restart:function(e,t){c({white:e,black:t})},switchMode:function(){ke(t,n,l,"/setup",!1)},openTheme:e.openTheme})]})}var Ae=n(19),Be=n(32),Ee=0,Ge=function e(t){Object(c.a)(this,e),this.theme=void 0,this.className=void 0,this.style=document.createElement("style"),t||(t=Be),this.theme=Object(Oe.a)({},t),this.className="ChessTheme-".concat(Ee),Ee++,C()(/^[0-9a-zA-Z#]+$/.test(this.theme.boardSquare.whiteColor),"Attempted xss"),C()(/^[0-9a-zA-Z#]+$/.test(this.theme.boardSquare.blackColor),"Attempted xss"),this.style.textContent="\n      .ChessBoardSquareWhite.".concat(this.className," {\n        background-color: ").concat(this.theme.boardSquare.whiteColor,";\n      }\n\n      .ChessBoardSquareBlack.").concat(this.className," {\n       background-color: ").concat(this.theme.boardSquare.blackColor,";\n      }\n    ")};function We(e){var t=Object(r.useState)(new Ge(e)),n=Object(s.a)(t,2),i=n[0],a=n[1];return Object(r.useEffect)((function(){return document.head.append(i.style),function(){i.style.remove()}})),[i,function(e){a(new Ge(e))}]}var Fe=n(27),De=n(28);function _e(e){var t=We(e.theme.theme),n=Object(s.a)(t,2),i=n[0],a=n[1],o=Object(r.useState)(0),c=Object(s.a)(o,2),u=c[0],h=c[1],l=Object(r.useRef)(null);Object(r.useEffect)((function(){function e(){g(l.current)}return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}));var d,f=[],b=Object(v.a)(Fe);try{for(b.s();!(d=b.n()).done;){var O=d.value;f.push(Object(le.jsx)("option",{value:O.id,children:O.name},O.id))}}catch(w){b.e(w)}finally{b.f()}var j,m=[],k=Object(v.a)(De);try{for(k.s();!(j=k.n()).done;){var p=j.value;m.push(Object(le.jsx)("option",{value:p.prefix,children:p.name},p.prefix))}}catch(w){k.e(w)}finally{k.f()}function y(){e.setTheme(e.theme.theme)}function g(e){e?(h(e.offsetHeight),l.current=e):l.current=null}return Object(le.jsxs)("div",{className:"Window",children:[Object(le.jsx)("div",{className:"WindowCover",onClick:y}),Object(le.jsxs)("div",{className:"WindowContents",children:[Object(le.jsx)("h1",{children:"Theme Setup"}),Object(le.jsx)("label",{children:"Board Theme:"}),Object(le.jsx)("select",{onChange:function(e){var t=Fe.find((function(t){return t.id===e.target.value})),n=Object(Oe.a)({},i.theme);n.boardSquare=Object(Oe.a)({},t),a(n)},value:i.theme.boardSquare.id,children:f}),Object(le.jsx)("label",{children:"Piece Theme:"}),Object(le.jsx)("select",{onChange:function(e){var t=De.find((function(t){return t.prefix===e.target.value})),n=Object(Oe.a)({},i.theme);n.piece=Object(Oe.a)({},t),a(n)},value:i.theme.piece.prefix,children:m}),Object(le.jsx)("div",{ref:g,className:"WindowChessBoardSizer",children:Object(le.jsx)("div",{className:"WindowChessBoard",style:{width:u-16},children:Object(le.jsx)(be,{state:W(),theme:i})})}),Object(le.jsx)("button",{onClick:function(){e.setTheme(i.theme)},children:"Confirm"}),Object(le.jsx)("button",{onClick:y,children:"Cancel"})]})]})}var Le=function(e){var t,n=We(),i=Object(s.a)(n,2),a=i[0],o=i[1],c=Object(r.useState)(!1),u=Object(s.a)(c,2),h=u[0],l=u[1];function d(){l(!0)}return h&&(t=Object(le.jsx)(_e,{theme:a,setTheme:function(e){o(e),l(!1)}})),Object(le.jsxs)(le.Fragment,{children:[t,Object(le.jsx)(Ae.a,{children:Object(le.jsxs)(pe.d,{children:[Object(le.jsx)(pe.a,{exact:!0,from:"/yachessjs/",to:"/yachessjs/play"}),Object(le.jsx)(pe.b,{path:"/yachessjs/play",children:Object(le.jsx)(Me,{theme:a,openTheme:d})}),Object(le.jsx)(pe.b,{path:"/yachessjs/setup",children:Object(le.jsx)(ge,{theme:a,openTheme:d})})]})})]})};window.YACHESS_DEBUG={perft:function(e,t){var n="";if(!Number.isInteger(t)||t<1)throw new Error("Invalid depth");var r,i=D(e).moves().filter((function(e){return!e.invalid()})),a=0,o=Object(v.a)(i);try{for(o.s();!(r=o.n()).done;){var s=r.value,c=s.do().perft(t-1);a+=c,n+="".concat(s.toNotation().toString()," has ").concat(c," nodes\n")}}catch(u){o.e(u)}finally{o.f()}return n+="There are ".concat(a," nodes in total")}},o.a.render(Object(le.jsx)(i.a.StrictMode,{children:Object(le.jsx)(Le,{})}),document.getElementById("root"))}},[[51,1,2]]]);
//# sourceMappingURL=main.c249127b.chunk.js.map